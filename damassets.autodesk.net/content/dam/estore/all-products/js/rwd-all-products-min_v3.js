var rwd_all_products=rwd_all_products||{options:{lang:"en",url:"/store/",jsonFile:"/content/dam/estore/all-products/json/products_amer.json",selector:".wp-product-box",path_badge:"//static-ww.autodesk.net/content/dam/estore/badges/90x90/",fadetime:"50",categoriesNumber:"5",categoriesName:{0:"CAD Software",1:"Animation Software",2:"Suites",3:"Cloud Services",4:"Other Software"},expand:"4",txt_no_result:"Your search returned no results. See all our software below or try another search term.",txt_most_pop:"Most popular",txt_all:"All",txt_more:"show more",txt_less:"show less",txt_plus:"+",txt_minus:"-",bestseller:"4",drop:"5",promo:{promo_1:"20% off",promo_2:"",promo_3:""}},_:function(t){for(this.options=$.extend(this.options,t),this.load(),isearch="inactive",ulDrop=$("ul.drop"),search=$("#search"),categories=[],cat=[],i=0;i<this.options.categoriesNumber;i++)cat.push([]),categories.push("cat_"+i);$("#taxonomy").change(function(){select=$(this).val(),rwd_all_products.filtre();var t=$(this).find("option:selected").text(),e=$("[data-wat-dynamic-filter-group='categories']");e.attr("data-wat-dynamic-filter-option",t),e.attr("data-wat-dynamic-filter-selected","TRUE"),"Choose option"===t&&(e.attr("data-wat-dynamic-filter-option",""),e.attr("data-wat-dynamic-filter-selected","FALSE")),rwd_all_products.analytics()}),$("span.taxonomy").click(function(){$(this).toggleClass("select"),rwd_all_products.filtre();var t=$(this).attr("data"),e=$("[data-wat-dynamic-filter-option='mac']"),o=$("[data-wat-dynamic-filter-option='windows']");"mac"===t&&($(this).hasClass("select")?e.attr("data-wat-dynamic-filter-selected","TRUE"):e.attr("data-wat-dynamic-filter-selected","FALSE")),"windows"===t&&($(this).hasClass("select")?o.attr("data-wat-dynamic-filter-selected","TRUE"):o.attr("data-wat-dynamic-filter-selected","FALSE")),rwd_all_products.analytics()}),$("span.raz").click(function(){isearch="inactive",$("input#search").val(""),rwd_all_products.research.clearResult(),$("span.taxonomy").removeClass("select"),$("#taxonomy option:eq(0)").prop("selected",!0),$(".loupe").css("fill","#777"),rwd_all_products.filtre()})},analytics:function(){try{analytics.callback.dynamicFilterChange()}catch(t){}},loadExperience:function(){function t(){var t={},e=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,o,a){t[o]=a});return t}this.research.init();var e=t().filter;if(e){var o=!0,a=[e];$("#taxonomy option[value="+e+"]").prop("selected",!0),this.filtre(o,a)}this.homepage(),this.expand(),this.glossary()},sortby:function(t){var e=1;return"-"===t[0]&&(e=-1,t=t.substr(1)),function(o,a){var s=o[t]<a[t]?-1:o[t]>a[t]?1:0;return s*e}},load:function(){$.ajax({url:this.options.jsonFile,crossDomain:!0,type:"GET",jsonpCallback:"allproducts",cache:!1,contentType:"application/json",dataType:"jsonp",success:function(t){products=t,nbrProducts=products.list.length,rwd_all_products.products(products)},error:function(){console.log("Error - load product")},complete:function(){console.log("success - load product")}})},products:function(){description="description_"+this.options.lang,keywords="keywords_"+this.options.lang,pd={products:[]};for(var t=0;t<nbrProducts;t++){var e=products.list[t].filters.split(",");pd.products.push({id:products.list[t].id,url:products.list[t].url,name:products.list[t].name,badge:products.list[t].badge,description:products.list[t][description],keywords:products.list[t][keywords],popularity:products.list[t].popularity,filters:e,promo:products.list[t].promo})}pd.products.sort(this.sortby("name")),this.productsloading()},product:function(t,e,o){switch(promo_txt="",promo=e.promo,promo){case"promo_1":promo=this.options.promo.promo_1;break;case"promo_2":promo=this.options.promo.promo_2;break;case"promo_3":promo=this.options.promo.promo_3}promo&&(promo_txt="<br><span class='promo'>"+promo+"</span>");var a='<div class="small-12 medium-6 large-3 grid-columns left wp-product-box '+o+'" id="'+e.id+'" data-name="'+e.name+'" data-filters="'+e.filters+'"><div class="marg"><div class="over"></div><svg class="wp-arrow"><use xlink:href="#icon-svg-arrow-button"></use></svg><div class="responsive-column-'+t+' responsive-column"><div class="column-content parsys"><a href="'+e.url+'" class="wp-product" data-wat-val="'+e.name+'"><div class="bdg"><img src="'+rwd_all_products.options.path_badge+e.badge+'" alt="'+e.name+'"></div><div class="cnt"><p>'+e.name+promo_txt+"</p></div></a></div></div></div></div>";return a},productsloading:function(){pd.products.sort(this.sortby("name"));var t="std";$.each(pd.products,function(e,o){$(".view2 .row").append(rwd_all_products.product(e,o,t))}),products=$(".view2 .wp-product-box "),this.loadExperience()},showProducts:function(t){$.each(t,function(t,e){e.is(":visible")||e.fadeIn(rwd_all_products.options.fadetime)})},hideProducts:function(t){$.each(t,function(t,e){e.is(":visible")&&e.fadeOut(rwd_all_products.options.fadetime)})},filtre:function(t,e){t||(e=[]),$("span.taxonomy.select").each(function(){var t=$(this).attr("data");return e.push(t),e});var o=$("#taxonomy").val();o&&e.push(o),"active"===isearch&&e.push("search"),page=$(".view2"),home=$("#homepage"),homeSection=$(".home"),nbr=e.length,nbr>"0"?(home.is(":visible")&&home.fadeOut(rwd_all_products.options.fadetime),page.is(":visible")||page.fadeIn(rwd_all_products.options.fadetime)):(home.is(":visible")||home.fadeIn(rwd_all_products.options.fadetime),page.is(":visible")&&page.fadeOut(rwd_all_products.options.fadetime)),display=[[],[]],$.each(products,function(t,o){var a=$(this),s=$(this).attr("id"),r=a.attr("data-filters"),i=!0;$.each(e,function(t,e){-1===r.indexOf(""+e)&&(i=!1,display[0].push(a))}),i===!0&&display[1].push(a)}),display[0].length>0&&this.hideProducts(display[0]),display[1].length>0&&(page.find(".notFound").remove(),this.showProducts(display[1])),0===display[1].length&&($(".notFound").length||(page.find(".wp-all-prod").prepend("<div class='notFound'f><h2>"+rwd_all_products.options.txt_no_result+"</h2></div>"),$(".notFound").fadeIn(rwd_all_products.options.fadetime)))},research:{clearResult:function(){$.each(products,function(t,e){var o=$(this),a=o.attr("data-filters");if(a.indexOf("search")>0){var s=a.replace(",search","");o.find("a").removeAttr("data-wat-search-result-click"),o.attr("data-filters",s)}})},search:function(){clicked="",url="",ulDrop.on("click","li",function(){clicked=$(this).find("a").attr("data-name"),url=$(this).find("a").attr("data-url"),rwd_all_products.research.analytics()}),search.keyup(function(t){t.preventDefault(),isearch="active",$(".loupe").css("fill","#0696D7"),searchField=search.val(),regex=new RegExp(""+searchField,"gi"),pd.products.sort(rwd_all_products.sortby("-popularity")),result=[],drop=[],$.each(pd.products,function(t,e){(-1!==e.name.search(regex)||-1!==e.description.search(regex)||-1!==e.keywords.search(regex))&&(output='<li><a data-name="'+e.name+'" data-url="'+e.url+'">'+e.name+"</a></li>",result.push(e.id),drop.push($(output)))}),searchField||(rwd_all_products.research.clearResult(),isearch="inactive",$(".loupe").css("fill","#777")),ulDrop.removeClass("border").children().remove(),$.each(drop,function(t,e){t<rwd_all_products.options.drop&&drop.length!==pd.products.length&&ulDrop.addClass("border").append($(this))}),(13===t.which||13===t.keyCode)&&rwd_all_products.research.display()})},display:function(){rwd_all_products.research.clearResult(),$.each(products,function(t,e){id=$(this).attr("id"),product=$(this),product_name=product.find("a").attr("data-wat-val"),$.each(result,function(t,e){if(e===+id){var o=product.attr("data-filters"),a=o+",search";product.attr("data-filters",a),product.find("a").attr("data-wat-search-result-click",'{"spot": "'+t+'", "section": "search results", "title": "'+product_name+'"}')}})}),ulDrop.removeClass("border").children().remove(),result.length===pd.products.length&&(isearch="inactive"),rwd_all_products.filtre(),rwd_all_products.research.analytics()},analytics:function(){"undefined"!=typeof analytics&&"undefined"!=typeof analytics.context&&"undefined"!=typeof analytics.context.changeContext&&analytics.context.changeContext({event:{eventType:"estore_search_result_page,estore_page_view"},page:{contentDescription:"search"},onSiteSearch:{searchTerm:searchField,searchResults:result.length,pagination:"",predictiveKeyword:clicked}}),url&&(window.location.href=url)},init:function(){rwd_all_products.research.search(),$(".wrapLoupe").click(function(){rwd_all_products.research.display()})}},homepage:function(){for($.each(pd.products,function(t,e){$.each(categories,function(o,a){pd.products[t].filters.indexOf(""+a)>0&&cat[o].push(e.id)})}),a=0;a<this.options.categoriesNumber;a++){var t="<div class='body-content parsys home cat_"+a+"' data-wat-loc='"+rwd_all_products.options.categoriesName[a]+"'><div class='responsive-grid section'><div class='row wd-pr-10 wd-pl-10 wp-all-prod'><h1>"+rwd_all_products.options.categoriesName[a]+"</h1><h2>"+rwd_all_products.options.txt_most_pop+"</h2><div class='best'></div><div class='other'><h2>"+rwd_all_products.options.txt_all+" "+rwd_all_products.options.categoriesName[a]+"</h2></div></div></div>";$("#homepage").append(t),$.each(cat[a],function(t,e){$.each(pd.products,function(t,o){if(o.id===e){var s="others_";$(".home .row:eq("+a+") .other").append(rwd_all_products.product(t,o,s))}})});var e="<div class='small-12 grid-columns left expandLine'><div class='responsive-column-1 responsive-column'> <div class='column-content parsys'><div class='expand "+a+"'><span class='plusminus'>+</span><span class='text'>"+rwd_all_products.options.txt_more+"</span></div><div class='line'></div></div></div></div>";$(".home .row:eq("+a+") .other").append(e)}for(bestseller=[],i=0;i<this.options.categoriesNumber;i++)bestseller.push([]);for(pd.products.sort(this.sortby("-popularity")),$.each(pd.products,function(t,e){$.each(categories,function(o,a){pd.products[t].filters.indexOf(""+a)>0&&bestseller[o].push(e.id)})}),a=0;a<this.options.categoriesNumber;a++){var o=1,s="std";$.each(bestseller[a],function(t,e){$.each(pd.products,function(r,i){i.id===e&&o<=rwd_all_products.options.bestseller&&($(".home .row:eq("+a+") .best").append(rwd_all_products.product(t,i,s)),o++)})})}},expand:function(){for(expand=[],toexpand=[],i=0;i<this.options.categoriesNumber;i++)expand.push([]),toexpand.push([]),expand[i].push($(".home:eq("+i+")").find(".others_"));for(a=0;a<this.options.categoriesNumber;a++)$.each(expand[a],function(t,e){$.each(e,function(t,e){t>=rwd_all_products.options.expand&&($(this).hide(),toexpand[a].push(e))})});open=0,$(".expand").click(function(){action=$(this).attr("class").split(" ")[1],text=$(this),rwd_all_products.act(action,text)})},act:function(t,e){return 0===open?(e.children("span.text").html(rwd_all_products.options.txt_less),e.children("span.plusminus").html(rwd_all_products.options.txt_minus),rwd_all_products.goexpand(toexpand[t]),open=1,open):1===open?(e.children("span.text").html(rwd_all_products.options.txt_more),e.children("span.plusminus").html(rwd_all_products.options.txt_plus),rwd_all_products.collapse(toexpand[t]),open=0,open):void 0},goexpand:function(t){$.each(t,function(){$(this).fadeIn(rwd_all_products.options.fadetime)}),open=0},collapse:function(t){$.each(t,function(){$(this).fadeOut(rwd_all_products.options.fadetime)}),open=1},glossary:function(){for(glossary=[["3","A"],["B","C","D","E","F","G","H"],["I","J","K","L","M","N","O","P"],["R","S","T","U","V","W","X","Y","Z"]],glos=[[],[],[],[]],$.each(glossary,function(t,e){$.each(products,function(e,o){var a=$(this).attr("data-name"),s=$(this).find(".wp-product").attr("href"),r=a.split(""),i=r[0];glossary[t].indexOf(i)>=0&&glos[t].push('<a href="'+s+'" data-wat-val="'+a+'"> '+a+"</a>")})}),a=0;a<4;a++)$.each(glos[a],function(t,e){var o=glos[a].length,s=o/3;s>t&&$(".glossaire .row:eq("+a+") .responsive-column-1").append(e),t>=s&&2*s>t&&$(".glossaire .row:eq("+a+") .responsive-column-2").append(e),t>=2*s&&$(".glossaire .row:eq("+a+") .responsive-column-3").append(e)})}};